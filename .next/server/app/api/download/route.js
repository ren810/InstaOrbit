"use strict";(()=>{var a={};a.id=182,a.ids=[182],a.modules={517:a=>{a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1242:(a,e,t)=>{t.r(e),t.d(e,{headerHooks:()=>g,originalPathname:()=>v,patchFetch:()=>h,requestAsyncStorage:()=>c,routeModule:()=>p,serverHooks:()=>m,staticGenerationAsyncStorage:()=>u,staticGenerationBailout:()=>w});var o={};t.r(o),t.d(o,{POST:()=>d});var s=t(5419),r=t(9108),l=t(9678),i=t(8070),n=t(6855);async function d(a){try{let{url:e}=await a.json();if(!e||"string"!=typeof e)return i.Z.json({error:"URL is required"},{status:400});if(!/^https?:\/\/(www\.)?instagram\.com\/(p|reel|tv|stories)\/[a-zA-Z0-9_-]+\/?(\?.*)?$/i.test(e))return i.Z.json({error:"Invalid Instagram URL. Please provide a valid Instagram post, reel, or story URL."},{status:400});let t=encodeURIComponent(e),o=process.env.RAPIDAPI_KEY1,s=process.env.RAPIDAPI_KEY2;if(!o||!s)return i.Z.json({error:"API keys not configured"},{status:500});try{let a=await fetch(`https://instagram-downloader-v2-scraper-reels-igtv-posts-stories.p.rapidapi.com/get-post?url=${t}`,{method:"GET",headers:{"x-rapidapi-key":o,"x-rapidapi-host":"instagram-downloader-v2-scraper-reels-igtv-posts-stories.p.rapidapi.com"}});if(a.ok){let e=await a.json();if((0,n.P_)("instagram-downloader-v2-scraper-reels-igtv-posts-stories.p.rapidapi.com",!0),e&&e.media&&Array.isArray(e.media)&&e.media.length>0){let a=e.media[0],t=e.media.length>1,o=e.media.map(a=>({type:a.is_video?"video":"image",url:a.url,thumbnail:a.is_video?a.thumb:a.url}));return i.Z.json({success:!0,api:"instagram-downloader-v2-scraper-reels-igtv-posts-stories.p.rapidapi.com",data:{thumbnail:a.is_video?a.thumb:a.url,title:a.caption||"Instagram Media",author:e.owner?.username?"@"+e.owner.username:"@instagram",downloadUrl:a.url||"#",type:a.is_video?"video":"image",quality:"HD",caption:a.caption||"",username:e.owner?.username?"@"+e.owner.username:"@instagram",mediaUrls:o,isCarousel:t,mediaCount:e.media.length,likes:a.like_count,comments:a.comment_count}})}}}catch(a){console.log("API 1 failed, trying API 2...",a),(0,n.P_)("instagram-downloader-v2-scraper-reels-igtv-posts-stories.p.rapidapi.com",!1)}try{let a=await fetch(`https://instagram-downloader-download-instagram-stories-videos4.p.rapidapi.com/convert?url=${t}`,{method:"GET",headers:{"x-rapidapi-key":s,"x-rapidapi-host":"instagram-downloader-download-instagram-stories-videos4.p.rapidapi.com"}});if(a.ok){let e=await a.json();if((0,n.P_)("instagram-downloader-download-instagram-stories-videos4.p.rapidapi.com",!0),e&&e.url)return i.Z.json({success:!0,api:"instagram-downloader-download-instagram-stories-videos4.p.rapidapi.com",data:{thumbnail:e.thumbnail||e.url||"https://picsum.photos/600/800",title:e.title||"Instagram Media",author:e.author||"@instagram",downloadUrl:e.url||"#",type:e.type||"video",quality:e.quality||"HD",caption:e.caption||"",username:e.author||"@instagram",mediaUrls:[{type:e.type||"video",url:e.url,thumbnail:e.thumbnail||e.url}],isCarousel:!1,mediaCount:1}})}}catch(a){console.log("API 2 also failed",a),(0,n.P_)("instagram-downloader-download-instagram-stories-videos4.p.rapidapi.com",!1)}return i.Z.json({error:"Failed to fetch Instagram media. The post might be private or deleted."},{status:404})}catch(a){return console.error("API Error:",a),i.Z.json({error:"Internal server error. Please try again later."},{status:500})}}let p=new s.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/download/route",pathname:"/api/download",filename:"route",bundlePath:"app/api/download/route"},resolvedPagePath:"C:\\Users\\riyan\\Downloads\\copy-of-instaorbit-downloader (3)1\\src\\app\\api\\download\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:c,staticGenerationAsyncStorage:u,serverHooks:m,headerHooks:g,staticGenerationBailout:w}=p,v="/api/download/route";function h(){return(0,l.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:u})}},6855:(a,e,t)=>{t.d(e,{de:()=>p,oJ:()=>u,P_:()=>c});let o=require("mongoose");var s=t.n(o);let r=process.env.MONGODB_URI;if(!r)throw Error("Please define MONGODB_URI environment variable in .env.local");let l=global.mongoose;l||(l=global.mongoose={conn:null,promise:null}),l=global.mongoose;let i=async()=>{if(l.conn)return console.log("Using cached MongoDB connection"),l.conn;l.promise||(l.promise=s().connect(r,{bufferCommands:!1,dbName:"instaorbit",maxPoolSize:10,serverSelectionTimeoutMS:5e3,socketTimeoutMS:45e3}).then(a=>(console.log("âœ… Connected to MongoDB successfully"),a)).catch(a=>{throw console.error("âŒ Error connecting to MongoDB:",a),l.promise=null,a}));try{l.conn=await l.promise}catch(a){throw l.promise=null,a}return l.conn},n=new(s()).Schema({apiHost:{type:String,required:!0,unique:!0,enum:["instagram-downloader-v2-scraper-reels-igtv-posts-stories.p.rapidapi.com","instagram-downloader-download-instagram-stories-videos4.p.rapidapi.com"]},totalCalls:{type:Number,default:0},successCalls:{type:Number,default:0},failedCalls:{type:Number,default:0},lastCallAt:{type:Date,default:null},dailyStats:{type:Map,of:Number,default:{}}},{timestamps:!0}),d=s().models.ApiUsage||s().model("ApiUsage",n);async function p(){try{await i();let a=await d.findOne({apiHost:"instagram-downloader-v2-scraper-reels-igtv-posts-stories.p.rapidapi.com"}),e=await d.findOne({apiHost:"instagram-downloader-download-instagram-stories-videos4.p.rapidapi.com"}),t={totalCalls:0,successCalls:0,failedCalls:0,lastCallAt:null,dailyStats:{}},o=a?{totalCalls:a.totalCalls,successCalls:a.successCalls,failedCalls:a.failedCalls,lastCallAt:a.lastCallAt?a.lastCallAt.toISOString():null,dailyStats:Object.fromEntries(a.dailyStats||new Map)}:t,s=e?{totalCalls:e.totalCalls,successCalls:e.successCalls,failedCalls:e.failedCalls,lastCallAt:e.lastCallAt?e.lastCallAt.toISOString():null,dailyStats:Object.fromEntries(e.dailyStats||new Map)}:t;return{"instagram-downloader-v2-scraper-reels-igtv-posts-stories.p.rapidapi.com":o,"instagram-downloader-download-instagram-stories-videos4.p.rapidapi.com":s,totalApiCalls:o.totalCalls+s.totalCalls,createdAt:new Date().toISOString()}}catch(a){return console.error("âŒ Error reading usage from MongoDB:",a),{"instagram-downloader-v2-scraper-reels-igtv-posts-stories.p.rapidapi.com":{totalCalls:0,successCalls:0,failedCalls:0,lastCallAt:null,dailyStats:{}},"instagram-downloader-download-instagram-stories-videos4.p.rapidapi.com":{totalCalls:0,successCalls:0,failedCalls:0,lastCallAt:null,dailyStats:{}},totalApiCalls:0,createdAt:new Date().toISOString()}}}async function c(a,e){(async()=>{try{console.log(`ðŸ”µ Tracking API call: ${a}, success: ${e}`),await i(),console.log("\uD83D\uDFE2 MongoDB connected");let t=new Date().toISOString().split("T")[0],o=await d.findOneAndUpdate({apiHost:a},{$inc:{totalCalls:1,successCalls:e?1:0,failedCalls:e?0:1,[`dailyStats.${t}`]:1},$set:{lastCallAt:new Date}},{upsert:!0,new:!0,setDefaultsOnInsert:!0});console.log("âœ… API call tracked successfully:",o?.apiHost,"Total:",o?.totalCalls)}catch(a){console.error("âŒ Error tracking API call in MongoDB:",a)}})()}async function u(){try{await i(),await d.deleteMany({}),console.log("âœ… Usage data reset successfully")}catch(a){throw console.error("âŒ Error resetting usage in MongoDB:",a),a}}}};var e=require("../../../webpack-runtime.js");e.C(a);var t=a=>e(e.s=a),o=e.X(0,[638,206],()=>t(1242));module.exports=o})();