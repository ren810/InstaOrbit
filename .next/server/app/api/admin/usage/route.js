"use strict";(()=>{var a={};a.id=680,a.ids=[680],a.modules={517:a=>{a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9036:(a,e,t)=>{t.r(e),t.d(e,{headerHooks:()=>C,originalPathname:()=>w,patchFetch:()=>y,requestAsyncStorage:()=>p,routeModule:()=>u,serverHooks:()=>m,staticGenerationAsyncStorage:()=>g,staticGenerationBailout:()=>f});var s={};t.r(s),t.d(s,{DELETE:()=>d,GET:()=>c});var o=t(5419),l=t(9108),r=t(9678),n=t(8070),i=t(6855);async function c(a){try{if(!a.cookies.get("admin_token")?.value)return n.Z.json({error:"Unauthorized"},{status:401});let e=await (0,i.de)();return console.log("\uD83D\uDCCA Fetched usage data:",e),n.Z.json({success:!0,data:e})}catch(a){return console.error("âŒ Usage stats error:",a),n.Z.json({error:"Failed to fetch usage stats",details:a.message},{status:500})}}async function d(a){try{if(!a.cookies.get("admin_token")?.value)return n.Z.json({error:"Unauthorized"},{status:401});return await (0,i.oJ)(),console.log("\uD83D\uDDD1ï¸ Usage stats reset"),n.Z.json({success:!0,message:"Usage stats reset successfully"})}catch(a){return console.error("âŒ Usage reset error:",a),n.Z.json({error:"Failed to reset usage stats",details:a.message},{status:500})}}let u=new o.AppRouteRouteModule({definition:{kind:l.x.APP_ROUTE,page:"/api/admin/usage/route",pathname:"/api/admin/usage",filename:"route",bundlePath:"app/api/admin/usage/route"},resolvedPagePath:"C:\\Users\\riyan\\Downloads\\copy-of-instaorbit-downloader (3)1\\src\\app\\api\\admin\\usage\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:p,staticGenerationAsyncStorage:g,serverHooks:m,headerHooks:C,staticGenerationBailout:f}=u,w="/api/admin/usage/route";function y(){return(0,r.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:g})}},6855:(a,e,t)=>{t.d(e,{de:()=>d,oJ:()=>p,P_:()=>u});let s=require("mongoose");var o=t.n(s);let l=process.env.MONGODB_URI;if(!l)throw Error("Please define MONGODB_URI environment variable in .env.local");let r=global.mongoose;r||(r=global.mongoose={conn:null,promise:null}),r=global.mongoose;let n=async()=>{if(r.conn)return console.log("Using cached MongoDB connection"),r.conn;r.promise||(r.promise=o().connect(l,{bufferCommands:!1,dbName:"instaorbit",maxPoolSize:10,serverSelectionTimeoutMS:5e3,socketTimeoutMS:45e3}).then(a=>(console.log("âœ… Connected to MongoDB successfully"),a)).catch(a=>{throw console.error("âŒ Error connecting to MongoDB:",a),r.promise=null,a}));try{r.conn=await r.promise}catch(a){throw r.promise=null,a}return r.conn},i=new(o()).Schema({apiHost:{type:String,required:!0,unique:!0,enum:["instagram-downloader-v2-scraper-reels-igtv-posts-stories.p.rapidapi.com","instagram-downloader-download-instagram-stories-videos4.p.rapidapi.com"]},totalCalls:{type:Number,default:0},successCalls:{type:Number,default:0},failedCalls:{type:Number,default:0},lastCallAt:{type:Date,default:null},dailyStats:{type:Map,of:Number,default:{}}},{timestamps:!0}),c=o().models.ApiUsage||o().model("ApiUsage",i);async function d(){try{await n();let a=await c.findOne({apiHost:"instagram-downloader-v2-scraper-reels-igtv-posts-stories.p.rapidapi.com"}),e=await c.findOne({apiHost:"instagram-downloader-download-instagram-stories-videos4.p.rapidapi.com"}),t={totalCalls:0,successCalls:0,failedCalls:0,lastCallAt:null,dailyStats:{}},s=a?{totalCalls:a.totalCalls,successCalls:a.successCalls,failedCalls:a.failedCalls,lastCallAt:a.lastCallAt?a.lastCallAt.toISOString():null,dailyStats:Object.fromEntries(a.dailyStats||new Map)}:t,o=e?{totalCalls:e.totalCalls,successCalls:e.successCalls,failedCalls:e.failedCalls,lastCallAt:e.lastCallAt?e.lastCallAt.toISOString():null,dailyStats:Object.fromEntries(e.dailyStats||new Map)}:t;return{"instagram-downloader-v2-scraper-reels-igtv-posts-stories.p.rapidapi.com":s,"instagram-downloader-download-instagram-stories-videos4.p.rapidapi.com":o,totalApiCalls:s.totalCalls+o.totalCalls,createdAt:new Date().toISOString()}}catch(a){return console.error("âŒ Error reading usage from MongoDB:",a),{"instagram-downloader-v2-scraper-reels-igtv-posts-stories.p.rapidapi.com":{totalCalls:0,successCalls:0,failedCalls:0,lastCallAt:null,dailyStats:{}},"instagram-downloader-download-instagram-stories-videos4.p.rapidapi.com":{totalCalls:0,successCalls:0,failedCalls:0,lastCallAt:null,dailyStats:{}},totalApiCalls:0,createdAt:new Date().toISOString()}}}async function u(a,e){(async()=>{try{console.log(`ðŸ”µ Tracking API call: ${a}, success: ${e}`),await n(),console.log("\uD83D\uDFE2 MongoDB connected");let t=new Date().toISOString().split("T")[0],s=await c.findOneAndUpdate({apiHost:a},{$inc:{totalCalls:1,successCalls:e?1:0,failedCalls:e?0:1,[`dailyStats.${t}`]:1},$set:{lastCallAt:new Date}},{upsert:!0,new:!0,setDefaultsOnInsert:!0});console.log("âœ… API call tracked successfully:",s?.apiHost,"Total:",s?.totalCalls)}catch(a){console.error("âŒ Error tracking API call in MongoDB:",a)}})()}async function p(){try{await n(),await c.deleteMany({}),console.log("âœ… Usage data reset successfully")}catch(a){throw console.error("âŒ Error resetting usage in MongoDB:",a),a}}}};var e=require("../../../../webpack-runtime.js");e.C(a);var t=a=>e(e.s=a),s=e.X(0,[638,206],()=>t(9036));module.exports=s})();